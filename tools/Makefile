CXX                 =  g++ -std=c++11

SRC_DIR             =   $(shell cat src_dir)
INC                 =   -I $(SRC_DIR)  -I . -I /usr/include/freetype2
CXXFLAGS            ?=  -DDEBUG -DUSE_SDL2

MKDIR               =   mkdir -p

#Subdirectoies that store the sources of r64fx itself.
R64FX_SOURCE_DIRS   =   utf8string jit gc gui json main

#Subdirectoies that may store glsl files that have to be compiled into resources.
GLSL_DIRS           =  $(SRC_DIR)/gui

.VPATH              =  $(GLSL_DIRS)

all: r64fx

#resource compilers
file2str:
	@$(CXX) $(SRC_DIR)/tools/file2str.cpp -O2 -o file2str

file2numlist:
	@$(CXX) $(SRC_DIR)/tools/file2numlist.cpp -O2 -o file2numlist


#helper scripts
gen_build_rules: src_dir
	@ln -sf $(SRC_DIR)/tools/gen_build_rules.sh

gen_resource_rules: src_dir
	@ln -sf $(SRC_DIR)/tools/gen_resource_rules.sh

#autogenerated build rules
autoconfig: gen_build_rules gen_resource_rules file2str
	@$(RM) build_rules; \
./gen_resource_rules.sh ./file2str '*.glsl' $(GLSL_DIRS) >> build_rules; \
./gen_build_rules.sh '$(CXX) $(INC) $(CXXFLAGS)' $(R64FX_SOURCE_DIRS) >> build_rules


-include build_rules


r64fx: $(object_files)
	$(CXX) $^ -o $@ -lSDL2 -lGL -lGLU -lftgl -lpng -ljack -lsndfile

clean: